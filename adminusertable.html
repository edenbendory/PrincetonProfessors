<!DOCTYPE html>
<html>
    <head>
        <title>Admin Controls</title>
        <meta name="viewport"
        content="width=device-width, initial-scale=1">

        <link rel="stylesheet" href=
 "https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">


        <style>
            .header, .footer {background-color:#06839a; color:white}
        </style>

    </head>

    <body>
        <div class="container-fluid header">
            <center>
                <h1>Admin Control Panel</h1>
            </center>
        </div>
<!-- <script src="path/to/jquery.min.js"></script> Include jQuery if not already included -->
<!-- <script src="path/to/db_utils.js"></script>
<script src="path/to/main.js"></script> -->
<div class="container-fluid">
<a href="/adminuserpage">Go back</a>
<h3>Displaying all reviews for {{username}}:</h3>
<hr>

<table class="table table-striped">

    {% if not reviews %}
    {{username}} has not left any reviews!
    <hr>

    {% else %}

    <button onclick="blockUserAndDeleteAllUserReviews('{{ username }}')">Delete All Reviews and Block this user</button>

    {% for review in reviews %}
    <div class="w3-container">
      <!-- make for loop for all reviews  -->
      {% set professor = get_professor(review) %}
      <h2>{{professor.name}}</h2>
      <p>Overall Rating: {{review.rating}} </p> <!-- gonna have to add this  -->
      <p>Content: {{review.content}} / 5.0 | Delivery {{review.delivery}} / 5.0 | Availability {{review.availability}} / 5.0 | Organization {{review.organization}} / 5.0</p>
      <p>Comments: {{review.comment}}</p>
      <p>Courses taken with {{professor.name}}: {{review.courses}}</p>
      <!-- *** WE NEED TO ADD A FUNCTION IN UTILS TO BE ABLE TO DELETE AN INDIVIDUAL REVIEW! -->
      <button onclick="deleteReview('{{review.reviewId}}', '{{professor.name}}', '{{professor.department}}')">Delete</button>
      <hr>
    </div>
    {% endfor %}
    {% endif %}
    <a href="/adminuserpage">Go back to all users</a>
</table>
</div>

<div class="container-fluid footer">
    <center>
        <p>Created by Eden Bendory, Jacob Colchamiro, Jonathan Mindel, Kayla Waitman</p>
    </center>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"> </script>
<script>

  'use strict'; 

  function handleDeleteResponse(data) {
    location.reload();
  }

  function handleError() {
    alert('Error: Failed to fetch data from server');
  }

  function deleteReview(reviewId, profname, profdept) {
    var result = confirm("Are you sure you want to delete this review?");
    if (result) {
        console.log("hi");
    console.log(reviewId);
    let url = "/delete_review?reviewId=" + reviewId + "&profName=" + profname + "&profDept=" + profdept;

    let deleteRequestData = {
      type: "DELETE",
      url: url,
      success: handleDeleteResponse,
      error: handleError,
    };
    $.ajax(deleteRequestData);
    }
    
  }

  function handleDeleteAllResponse(data) {
        location.reload();
  }

  function blockUserAndDeleteAllUserReviews(username) {
        var result = confirm("Are you sure you want to block " + username + " and delete all of their reviews?");
        if (result) {
            console.log("Deleting all reviews for " + username);
            let url = "/delete_all_reviews?username=" + username;

            let deleteAllRequestData = {
                type: "DELETE",
                url: url,
                success: handleDeleteAllResponse,
                error: handleError,
            };

            $.ajax(deleteAllRequestData);
        }
  }

</script>